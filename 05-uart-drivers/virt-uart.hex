# NS16550 compatible UART driver

# UART init

# UART_BASE := 0x10000000

b7 02 00 10  # lui t0, 0x10000

## Disable interrupts

a3 a0 02 00  # sw x0 1(t0)

# Enable DLAB

13 03 00 08  # addi t1 x0 0x80
a3 a1 62 00  # sw t1 3(t0)

# Set baud rate divisor = 1 (115200 @ 1.8432 MHz)

13 03 10 00  # addi t1 x0 0x1
23 a0 62 00  # sw t1 0(t0)
a3 a0 02 00  # sw x0 1(t0)

# 8 data bits, no parity, 1 stop bit, clear DLAB

13 03 30 00  # addi t1 x0 0x3
a3 a1 62 00  # sw t1 3(t0)

# Enable FIFO, clear RX/TX FIFO

13 03 70 00  # addi t1 x0 0x7
23 a1 62 00  # sw t1 2(t0)

# pad to 0xa0

13 00 00 00  # nop

13 00 00 00  # nop
13 00 00 00  # nop
13 00 00 00  # nop
13 00 00 00  # nop

13 00 00 00  # nop
13 00 00 00  # nop
13 00 00 00  # nop
13 00 00 00  # nop

13 00 00 00  # nop
13 00 00 00  # nop
13 00 00 00  # nop
13 00 00 00  # nop

13 00 00 00  # nop
13 00 00 00  # nop
13 00 00 00  # nop
13 00 00 00  # nop

13 00 00 00  # nop
13 00 00 00  # nop
13 00 00 00  # nop
13 00 00 00  # nop

13 00 00 00  # nop
13 00 00 00  # nop
13 00 00 00  # nop
13 00 00 00  # nop

13 00 00 00  # nop
13 00 00 00  # nop
13 00 00 00  # nop
13 00 00 00  # nop

# 0xa0: READ_UART
b7 02 00 10  # lui t0 0x10000
03 83 52 00  # lb t1 5(t0)
13 73 03 02  # andi t1 t1 0x20
e3 0c 03 fe  # beq t1 x0 -0x8
23 80 a2 00  # sb a0 0(t0)
67 80 00 00  # jalr x0 x1 0x0 / ret

13 00 00 00  # nop
13 00 00 00  # nop

# 0xc0: WRITE_UART
b7 02 00 10  # lui t0 0x10000
03 83 52 00  # lb t1 5(t0)
13 73 13 00  # andi t1 t1 0x1
e3 0c 03 fe  # beq t1 x0 -0x8
03 85 02 00  # lb a0 0(t0)
67 80 00 00  # jalr x0 x1 0x0 / ret

13 00 00 00  # nop
13 00 00 00  # nop

# pad to 0x100
13 00 00 00  # nop
13 00 00 00  # nop
13 00 00 00  # nop
13 00 00 00  # nop
